# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MCP Weather —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ curl

## ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. Health Check (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç)

```bash
curl http://localhost:9001/health
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `OK`

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç `OK`.

---

## üîå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SSE endpoint

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SSE endpoint

SSE (Server-Sent Events) endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MCP –∫–ª–∏–µ–Ω—Ç–æ–≤:

```bash
curl -N http://localhost:9001/sse
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `-N` –æ—Ç–∫–ª—é—á–∞–µ—Ç –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –∏ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–π

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è, –Ω–æ —Å–æ–±—ã—Ç–∏–π –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ MCP —Å–æ–æ–±—â–µ–Ω–∏–π.

**–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:** –ù–∞–∂–º–∏—Ç–µ `Ctrl+C`

---

## üì® –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

**–í–∞–∂–Ω–æ:** MCP —á–µ—Ä–µ–∑ SSE —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ MCP –∫–ª–∏–µ–Ω—Ç–∞. –ü—Ä—è–º—ã–µ HTTP POST –∑–∞–ø—Ä–æ—Å—ã –∫ `/messages/` –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Python —Å–∫—Ä–∏–ø—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install mcp httpx

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python test_mcp.py --port 9001
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç health check
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –ü–æ–ª—É—á–∏—Ç —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 4. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ MCP SDK

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π –∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
import asyncio
from mcp import ClientSession
from mcp.client.sse import sse_client

async def test_mcp():
    sse_url = "http://localhost:9001/sse"
    
    async with sse_client(sse_url) as (read, write):
        async with ClientSession(read, write) as session:
            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            await session.initialize()
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
            tools = await session.list_tools()
            print("–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:", [t.name for t in tools.tools])
            
            # –í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            result = await session.call_tool(
                "get_current_weather",
                {"location": "–ú–æ—Å–∫–≤–∞"}
            )
            print("–†–µ–∑—É–ª—å—Ç–∞—Ç:", result.content[0].text)

asyncio.run(test_mcp())
```

### 5. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—Ä—è–º—ã–µ POST –∑–∞–ø—Ä–æ—Å—ã –∫ `/messages/` —Ç—Ä–µ–±—É—é—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å `session_id`. –≠—Ç–æ —Å–ª–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ curl. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python —Å–∫—Ä–∏–ø—Ç –≤—ã—à–µ.

–ï—Å–ª–∏ –≤—Å–µ –∂–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ curl, —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `curl -N http://localhost:9001/sse`
2. –ü–æ–ª—É—á–∏—Ç—å `session_id` –∏–∑ SSE –ø–æ—Ç–æ–∫–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç `session_id` –≤ POST –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ `/messages/`

–≠—Ç–æ —Å–ª–æ–∂–Ω–æ –∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Python —Å–∫—Ä–∏–ø—Ç `test_mcp.py`.

---

## üêç Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_mcp.py`! –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
pip install mcp httpx

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python test_mcp.py --port 9001

# –ò–ª–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
python test_mcp.py --host your-server.com --port 9001
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç health check
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ MCP SDK
- ‚úÖ –ü–æ–ª—É—á–∏—Ç —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–∏—Å–∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π MCP Python SDK, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç SSE —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ session_id.

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Docker

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker logs mcp-weather
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
docker logs -f mcp-weather
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker ps | grep mcp-weather
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞

```bash
docker port mcp-weather
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `OK`
- [ ] SSE endpoint –¥–æ—Å—Ç—É–ø–µ–Ω (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)
- [ ] –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ `/messages/`
- [ ] –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `get_current_weather` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `get_weather_forecast` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `search_location` —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Connection refused"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
docker ps | grep mcp-weather

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç
docker port mcp-weather
```

### –û—à–∏–±–∫–∞ "Method not allowed"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π HTTP –º–µ—Ç–æ–¥ (GET –¥–ª—è `/health` –∏ `/sse`, POST –¥–ª—è `/messages/`)

### –û—à–∏–±–∫–∞ "Invalid JSON"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON –≤ –∑–∞–ø—Ä–æ—Å–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Type: application/json` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker logs mcp-weather`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Open-Meteo API)

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –æ–¥–Ω–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º

```bash
#!/bin/bash
echo "=== –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MCP Weather —Å–µ—Ä–≤–µ—Ä–∞ ==="
echo ""
echo "1. Health check:"
curl -s http://localhost:9001/health
echo ""
echo ""
echo "2. –°–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:"
curl -s -X POST http://localhost:9001/messages/ \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}' | jq .
echo ""
echo "3. –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ:"
curl -s -X POST http://localhost:9001/messages/ \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"get_current_weather","arguments":{"location":"–ú–æ—Å–∫–≤–∞"}}}' | jq -r '.result.content[0].text'
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ `test.sh`, —Å–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
chmod +x test.sh
./test.sh
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞ JSON —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `jq`: `brew install jq` (macOS) –∏–ª–∏ `apt-get install jq` (Linux)
